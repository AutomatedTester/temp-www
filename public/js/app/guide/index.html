<div class="jumbotron">
  <div class="container">
    <h1>Developer Guide</h1>
  </div>
</div>

<div class="container bs-docs-container">
  <div class="row">
  <div class="col-md-3">
    <div class="bs-sidebar hidden-print" role="complementary">
      <ul class="nav bs-sidenav">
        <li>
          <a href="#guide">Overview</a>
          <ul class="nav">
            <li><a href="#whatis-nightwatch">What is Nightwatch?</a></li>
            <li><a href="#selenium-overview">Overview of Selenium</a></li>
            <li><a href="#theory-of-operation">Theory of Operation</a></li>
          </ul>
        </li>

        <li>
          <a href="#installation">Getting started</a>
          <ul class="nav">
            <li><a href="#install-nodejs">Node.js</a></li>
            <li><a href="#install-selenium">Selenium Server</a></li>
          </ul>
        </li>

        <li>
          <a href="#usage">Using Nightwatch</a>
          <ul class="nav">
            <li><a href="#write-tests">Writing Tests</a></li>
            <li><a href="#test-runner">Nightwatch Runner</a></li>
            <li><a href="#runner-options">Command-line Options</a></li>
            <li><a href="#settings-file">Configuration file</a></li>
            <li><a href="#test-groups">Test Groups</a></li>
            <li><a href="#setup-teardown">setUp and tearDown</a></li>
            <li><a href="#custom-commands">Custom commands</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>

  <div class="col-md-9" role="main">
  <div class="docs-section">
    <div class="page-header" id="guide">
      <a name="guide"></a><h2>Overview</h2>
    </div>

    <h3 id="whatis-nightwatch">What is Nightwatch?</h3>
    <p>
      Nightwatch.js is an automated testing framework for web application and websites, written in <a href="http://nodejs.org/" target="__blank">Node.js</a>
      and using the <a href="https://w3c.github.io/webdriver/webdriver-spec.html" target="_blank">WebDriver API</a>.
    </p>
    <p>
      It is a complete browser automation (<em>End-to-End</em>) solution which aims to simplify the process of setting up <strong>Continous Integration</strong> and writing of automated tests.
    </p>
    <p>
      <blockquote style="font-style: normal">
      Nightwatch got its name from the famous painting <a href="http://en.wikipedia.org/wiki/The_Night_Watch" target="_blank">The Night Watch</a> by Dutch painter <a href="http://en.wikipedia.org/wiki/Rembrandt_Harmenszoon_van_Rijn" target="_blank">Rembrandt van Rijn</a>. The masterpiece is prominently displayed in the Rijksmuseum, in Amsterdam - The Netherlands.
      </blockquote>
    </p>

    <h3 id="selenium-overview"><a name="selenium-overview"></a>Overview of Selenium</h3>
    <p>Selenium is a very popular and comprehensive set of tools for browser automation, initially written for Java but now with support for most programming languages.</p>
    <p>
      Selenium's main projects are:
      <ul>
        <li><a href="http://docs.seleniumhq.org/projects/ide/" target="_blank">Selenium IDE</a></li>
        <li><a href="http://docs.seleniumhq.org/projects/remote-control/" target="_blank">Selenium Remote Control</a></li>
        <li><a href="http://docs.seleniumhq.org/projects/webdriver/" target="_blank">Selenium WebDriver</a></li>
        <li><a href="http://docs.seleniumhq.org/projects/grid/" target="_blank">Selenium Grid</a></li>
      </ul>
    </p>
    <p>
      Nightwatch uses the Selenium WebDriver, specifically the <a href="http://code.google.com/p/selenium/wiki/JsonWireProtocol" target="_blank">WebDriver Wire Protocol</a> to perform the browser automation related tasks.
     </p>

    <h3 id="theory-of-operation"><a name="theory-of-operation"></a>Theory of Operation</h3>
    <p>
      Nightwatch works by sending HTTP requests to the Selenium server with the right parameters and interpreting the response.
      The restful API protocol is defined by the <a href="https://github.com/SeleniumHQ/selenium/wiki/JsonWireProtocol" target="_blank">Selenium JsonWireProtocol</a>. See below for an example workflow for browser initialization.
    </p>
    <p style="margin-left: -20px;"><img src="/img/operation.png"></p>
    <p>
      Most of the times, Nightwatch needs to send at least 2 requests to the Selenium server in order to perform a command or assetion, the first one being the request to locate an element given a CSS selector (or Xpath expression) and the next to perform the actual command/assertion on the given element.
    </p>
  </div>

  <div class="docs-section">
      <div class="page-header">
        <a name="installation"></a>
        <h2 id="installation">Installation</h2>
      </div>

      <h3>Using npm</h3>
      <p>To install the latest version using the npm command line tool, run the following:</p>
      <pre class="light">npm install nightwatch</pre>

      <h3 id="install-nodejs"><a name="install-nodejs"></a>Node.js</h3>
      <p>
        From <a href="http://nodejs.org/" target="_blank">nodejs.org</a>:
        <blockquote>"Node.js is a platform built on Chrome's JavaScript runtime for easily building fast, scalable network applications. Node.js uses an event-driven, non-blocking I/O model that makes it lightweight and efficient, perfect for data-intensive real-time applications that run across distributed devices."</blockquote>
        There are installation packages and instructions for most major Operating systems on its website <a href="http://nodejs.org/" target="_blank">nodejs.org</a>.
      </p>

      <h3 id="install-selenium"><a name="install-selenium"></a>Running the Selenium Server</h3>
      <p>The Selenium WebDriver server is simply a Java servlet which runs separately on the machine with the browser you want to test.</p>
      <h4>Download Selenium</h4>
      <p>Download the latest version of the <code>selenium-server-standalone-{VERSION}.jar</code> file from the <a href="http://code.google.com/p/selenium/downloads/list" target="_blank">Selenium downloads page</a> and
        place it on the computer with the browser you want to test.
      </p>
      <h4>Running Selenium Automatically</h4>
      <p>If the server is on the same machine where Nightwatch is running, it can be started/stopped directly by the <a href="#test-runner">Nightwatch Test Runner</a>.</p>

      <h4>Running Selenium Manually</h4>
      <p>
        To run the selenium server manually, from the directory with the jar run the following:

        <pre class="light">java -jar selenium-server-standalone-{VERSION}.jar</pre>
        More info about running the Selenium server can be found here:<br>
        <a href="http://code.google.com/p/selenium/wiki/RemoteWebDriverServer" target="_blank">http://code.google.com/p/selenium/wiki/RemoteWebDriverServer</a>
      </p>
      <p>
        For viewing all the run-time options, run the previous command adding the <code>-help</code>:
        <pre class="light">java -jar selenium-server-standalone-{VERSION}.jar -help</pre>
      </p>
  </div>

  <div class="docs-section">
    <div class="page-header" id="usage">
      <h2>Using Nightwatch</h2>
    </div>

    <h3 id="write-tests"><a name="write-tests"></a>Writing Tests</h3>
    <p>
      Using the prefered CSS selector model to locate elements on a page, Nightwatch makes it very easy to write automated End-to-End test cases.
    </p>
<p>Create a separate folder for tests in your project, e.g.: <code>tests</code>. Each file inside it will be loaded as a test by the Nightwatch test runner.
A basic test will look like this:</p>
<div class="sample-test">
<pre data-language="javascript">
module.exports = {
  "Demo test Google" : function (browser) {
    browser
      .url("http://www.google.com")
      .waitForElementVisible('body', 1000)
      .setValue('input[type=text]', 'nightwatch')
      .waitForElementVisible('button[name=btnG]', 1000)
      .click('button[name=btnG]')
      .pause(1000)
      .assert.containsText('#main', 'The Night Watch')
      .end();
  }
};</pre>
</div>
    <p>Remember <strong>always</strong> to call the <code>.end()</code> method when you want to close your test, in order for the selenium session to be properly closed.
    </p>
    <p>A test can have multiple steps, if needed:</p>
<div class="sample-test">
<pre data-language="javascript">
module.exports = {
  "step one" : function (browser) {
    browser
      .url("http://www.google.com")
      .waitForElementVisible('body', 1000)
      .setValue('input[type=text]', 'nightwatch')
      .waitForElementVisible('button[name=btnG]', 1000)
  },

  "step two" : function (browser) {
    browser
      .click('button[name=btnG]')
      .pause(1000)
      .assert.containsText('#main', 'The Night Watch')
      .end();
  }
};</pre>
</div>
    <p>Tests can also be written in this format:</p>
<div class="sample-test">
<pre data-language="javascript">
this.demoTestGoogle = function (browser) {
  browser
    .url("http://www.google.com")
    .waitForElementVisible('body', 1000)
    .setValue('input[type=text]', 'nightwatch')
    .waitForElementVisible('button[name=btnG]', 1000)
    .click('button[name=btnG]')
    .pause(1000)
    .assert.containsText('#main', 'The Night Watch')
    .end();
};</pre>
</div>
    <h3 id="test-runner"><a name="test-runner"></a>Test Runner</h3>
    <p>
      Nightwatch includes a command-line test runner which makes it easy to run tests and generate useful output.
    </p>
    <h4>Example usage:</h4>
    <pre class="light">$ ./nightwatch -t tests/demotest.js</pre>
    <p>
      To use the test runner in your project
      simply create a new file called <code>nightwatch</code> and add the following:
    </p>

    <h5>For Linux and MacOSX:</h5>
<pre class="light">#!/usr/bin/env node
require('nightwatch/bin/runner.js');</pre>

    <p>
      Then set the permissions: <pre class="light">chmod a+x nightwatch</pre>
    </p>

    <h5>For Windows:</h5>
    <p>
      Name the file <code>nightwatch.js</code> and add the following line:
    </p>
<pre class="light">
require('nightwatch/bin/runner.js');</pre>
    <p>Then run as follow:</p>
    <pre class="light">C:\workspace\project> node nightwatch.js</pre>
    <a name="runner-options"></a>
    <h3 id="runner-options">Command-line Options</h3>
    <p>The test runner supports a number of run-time options to be passed at. To view all, run the following:</p>
    <pre class="light">./nightwatch --help</pre>

    <div class="table-responsive">
      <table class="table table-bordered table-striped">
        <thead>
         <tr>
           <th style="width: 100px;">Name</th>
           <th style="width: 100px;">Shortname</th>
           <th style="width: 50px;">default</th>
           <th>description</th>
         </tr>
        </thead>
        <tbody>
         <tr>
           <td><code>--config</code></td>
           <td><code>-c</code></td>
           <td><code>./settings.json</code></td>
           <td>The location of the <code>settings.json</code> file - the configuration file which the runner uses and which also includes the Selenium WebDriver options.</td>
         </tr>
         <tr>
           <td><code>--output</code></td>
           <td><code>-o</code></td>
           <td><code>tests_output</code></td>
           <td>The location where the JUnit XML reports will be saved.</td>
         </tr>
         <tr>
           <td><code>--env</code></td>
           <td><code>-e</code></td>
           <td><code>default</code></td>
           <td>Which testing environment to use - defined in <code>settings.json</code></td>
         </tr>
         <tr>
           <td><code>--verbose</code></td>
           <td><code>-v</code></td>
           <td></td>
           <td>Shows extended selenium command logging during the session</td>
         </tr>
         <tr>
           <td><code>--test</code></td>
           <td><code>-t</code></td>
           <td></td>
           <td>Runs only the specified test. By default it will attempt to run all tests in the folder and its subfolders.</td>
         </tr>
         <tr>
           <td><code>--group</code></td>
           <td><code>-g</code></td>
           <td></td>
           <td>Runs only the specified group of tests (subfolder). Tests are grouped by being placed in the same subfolder.</td>
         </tr>
         <tr>
           <td><code>--skipgroup</code></td>
           <td><code>-s</code></td>
           <td></td>
           <td>Skip one or several (comma separated) group of tests.</td>
         </tr>
        </tbody>
      </table>
    </div>

      <h3 id="settings-file"><a name="settings-file"></a>Configuration file</h3>
      <p>The test runner expects a configuration file to be passed, using by default a <code>settings.json</code> file from the current directory, if present.
        So let's create one in the same folder as the previous <code>nightwatch</code> runner file.</p>
      <p>The <code>settings.json</code> file will look like this:</p>
<pre class="light">{
  <strong>"src_folders"</strong> : ["examples/tests"],
  <strong>"output_folder"</strong> : "examples/reports",
  <strong>"custom_commands_path"</strong> : "",

  <strong>"selenium"</strong> : {
    "start_process" : false,
    "server_path" : "",
    "log_path" : "",
    "host" : "127.0.0.1",
    "port" : 4444
  },

  <strong>"test_settings"</strong> : {
    "default" : {
      "launch_url" : "http://localhost",
      "selenium_port"  : 4444,
      "selenium_host"  : "localhost",
      "silent": true,
      "firefox_profile": false,
      "screenshots" : {
        "enabled" : false,
        "path" : ""
      },
      "desiredCapabilities": {
        "browserName": "firefox",
        "javascriptEnabled": true,
        "acceptSslCerts": true
      }
    }
  }
}</pre>
    <div class="table-responsive">
      <h4>Basic settings:</h4>
      <table class="table table-bordered table-striped">
        <thead>
         <tr>
           <th style="width: 100px;">Name</th>
           <th style="width: 100px;">type</th>
           <th style="width: 50px;">default</th>
           <th>description</th>
         </tr>
        </thead>
        <tbody>
         <tr>
           <td>src_folders</td>
           <td>string|array</td>
           <td>none</td>
           <td>An array of folders (excluding subfolders) where the tests are located.</td>
         </tr>
         <tr>
           <td>output_folder <br><span class="optional">Optional</span></td>
           <td>string</td>
           <td>tests_output</td>
           <td>The location where the JUnit XMS report files will be saved.</td>
         </tr>
         <tr>
           <td>custom_commands_path <span class="optional">Optional</span></td>
           <td>string</td>
           <td>none</td>
           <td>Location where custom commands will be loaded from.</td>
         </tr>
         <tr>
           <td>selenium <br><span class="optional">Optional</span></td>
           <td>object</td>
           <td></td>
           <td>An object containing Selenium Server related configuration options. See below for details.</td>
         </tr>
          <tr>
           <td>test_settings</td>
           <td>object</td>
           <td></td>
           <td>This object contains all the test related options. See below for details.</td>
         </tr>
        </tbody>
      </table>
   </div>

      <h4>Selenium settings:</h4>
      <p>
        Below are a number of options for the selenium server process. Nightwatch can start and stop the Selenium process automatically which is very convenient as you don't have to manage this yourself and focus only on the tests.
      </p>
      <p>If you'd like to enable this, set <code>start_process</code> to <code>true</code> and specify the location of the <code>jar</code> file inside <code>server_path</code>.</p>

      <table class="table table-bordered table-striped">
        <thead>
         <tr>
           <th style="width: 100px;">Name</th>
           <th style="width: 100px;">type</th>
           <th style="width: 50px;">default</th>
           <th>description</th>
         </tr>
        </thead>
        <tbody>
         <tr>
           <td>start_process</td>
           <td>boolean</td>
           <td>false</td>
           <td>Weather or not to manage the selenium process automatically.</td>
         </tr>
         <tr>
           <td>server_path</td>
           <td>string</td>
           <td>none</td>
           <td>The location of the selenium <code>jar</code> file. This needs to be specified if <code>start_process</code> is enabled.<br>E.g.: <code>lib/selenium-server-standalone-2.39.0.jar</code></td>
         </tr>
         <tr>
           <td>log_path</td>
           <td>string</td>
           <td>none</td>
           <td>The location where the selenium <code>output.log</code> file will be placed. Defaults to current directory.</td>
         </tr>
         <tr>
           <td>host</td>
           <td>string</td>
           <td>127.0.0.1</td>
           <td>Usually not required, specify the IP address you wish Selenium to listen on.</td>
         </tr>
         <tr>
           <td>port</td>
           <td>integer</td>
           <td>4444</td>
           <td>The port number Selenium will listen on.</td>
         </tr>
         </tbody>
       </table>

      <h4>Test settings:</h4>
      <p>
        Below are a number of options that will be passed to the Nightwatch instance. You can specify multiple groups of options so you could have different values per environment:
      </p>
      <pre class="light">{
  ...
  <strong>"test_settings"</strong> : {
    "default" : {
      ...
    },
    "integration" : {
      ...
    }
  }
}</pre>
      <p>The key of the settings group can be passed then to the runner as the <code>--env</code> argument to use the specified settings, like so:</p>
<pre class="light">./nightwatch integration</pre>
      <p>
       This can be useful if you need to have different settings for your local machine and the Continous Integration server.
      </p>

      <table class="table table-bordered table-striped">
        <thead>
         <tr>
           <th style="width: 100px;">Name</th>
           <th style="width: 100px;">type</th>
           <th style="width: 50px;">default</th>
           <th>description</th>
         </tr>
        </thead>
        <tbody>
         <tr>
           <td>launch_url</td>
           <td>string</td>
           <td>none</td>
           <td>A url which can be used later in the tests as the main url to load. Can be useful if your tests will run on different environments, each one with a different url.</td>
         </tr>
         <tr>
           <td>selenium_host</td>
           <td>string</td>
           <td>localhost</td>
           <td>The hostname/IP on which the selenium server is accepting connections.</td>
         </tr>
         <tr>
           <td>selenium_port</td>
           <td>integer</td>
           <td>4444</td>
           <td>The port number on which the selenium server is accepting connections.</td>
         </tr>
         <tr>
           <td>silent</td>
           <td>boolean</td>
           <td>true</td>
           <td>Weather to show extended Selenium command logs.</td>
         </tr>
         <tr>
           <td>output</td>
           <td>boolean</td>
           <td>true</td>
           <td>Use to disable terminal output completely.</td>
         </tr>
         <tr>
           <td>firefox_profile</td>
           <td>string|boolean</td>
           <td>none</td>
           <td>Selenium will be default create a new Firefox profile for each session. If you wish to use an existing Firefox profile you can specify its name here.</td>
         </tr>
         <tr>
           <td>screenshots</td>
           <td>object</td>
           <td>none</td>
           <td>Selenium generates screenshots when command errors occur. These can be saved somewhere on the disk.
             <br>Example: <code>"screenshots" : {"enabled" : true, "path" : ""}</code></td>
         </tr>
         <tr>
           <td>username</td>
           <td>string</td>
           <td>none</td>
           <td>In case the selenium server requires credentials this username will be used to compute the <code>Authorization</code> header. <br><br>The value can be also an environment variable, in which case it will look like this:<br>
             <code>"username" : "${SAUCE_USERNAME}"</code>
           </td>
         </tr>
         <tr>
           <td>access_key</td>
           <td>string</td>
           <td>none</td>
           <td>This field will be used together with <code>username</code> to compute the <code>Authorization</code> header. <br><br>Like <code>username</code>, the value can be also an environment variable:<br>
             <code>"access_key" : "${SAUCE_ACCESS_KEY}"</code>
           </td>
         </tr>

         <tr>
           <td>desiredCapabilities</td>
           <td>object</td>
           <td></td>
           <td>An object wich will be passed to the Selenium WebDriver when a new session will be created. You can specify browser name for instance along with other capabilities.
             <br>Example:<br>
<code>"desiredCapabilities" : {<br>
  &nbsp;&nbsp;"browserName" : "firefox", <br>&nbsp;&nbsp;"acceptSslCerts" : true<br>}</code><br>
             You can view the complete list of capabilities <a href="https://github.com/SeleniumHQ/selenium/wiki/JsonWireProtocol#capabilities-json-object" target="_blank">here</a>.
           </td>
         </tr>
         </tbody>
       </table>

       <h3 id="test-groups"><a name="test-groups"></a>Test Groups</h3>
       <p>Nightwatch.js makes it possible to organized your test scripts into groups and run them as needed.
         To group tests together just place them in the same sub-folder. The folder name is the name of the group.</p>
       <h4>Example:</h4>
       <pre class="light">
tests/
  ├── logingroup
  |   ├── login_test.js
  |   └── otherlogin_test.js
  ├── addressbook
  |   ├── addressbook_test.js
  |   └── contact_test.js
  ├── chat
  |   ├── chatwindow_test.js
  |   ├── chatmessage_test.js
  |   └── otherchat_test.js
  └── smoketests
      ├── smoke_test.js
      └── othersmoke_test.js</pre>
      <p>To run only the <code>smoketests</code> group you would do the following:</p>
      <pre class="light">./nightwatch -g smoketests</pre>
      <p>Also, if you would want to skip running the <code>smoketests</code> group you would do the following:</p>
      <pre class="light">./nightwatch -s smoketests</pre>
      <p>To skip multiple groups, just add them as comma-separated:</p>
      <pre class="light">./nightwatch -s addressbook,chat</pre>
      <h3 id="setup-teardown"><a name="setup-teardown"></a>setUp and tearDown methods</h3>
      <p>The <code>setUp</code> and <code>tearDown</code> methods are standard to any testing framework. As the name suggests, <code>setUp</code> runs before each test step and <code>tearDown</code> after each one respectively.</p>
      <p>The <code>setUp</code> method is called with the Nightwatch instance passed as argument, while <code>tearDown</code> is called without any arguments as the asynchronous commands queue is finished by then and (presumably) the session is ended.</p>
      <h4>Example:</h4>
      <div class="sample-test">
<pre data-language="javascript">
module.exports = {
  setUp : function(browser) {
    console.log('Setting up...');
  },

  tearDown : function() {
    console.log('Closing down...');
  },

  "step one" : function (browser) {
    browser
      ...
  },

  "step two" : function (browser) {
    browser
    ...
      .end();
  }
};</pre>
</div>
      <p>In the example abobe the sequence of method calles will be as follows:
        <code>setUp(), "step one", tearDown(), setUp(), "step two", tearDown()</code></p>

    <h3 id="custom-commands"><a name="custom-commands"></a>Defining Custom Commands</h3>
    <p>Most of the time you will need to extend the Nightwatch commands to suite your own application needs. Doing that
      is only a matter of creating a separate folder and defining your commands in that folder, each one inside its own file.
    </p>
    <p>
      Then specify the path to that folder inside the <code>settings.json</code> file, as the <code>custom_commands_path</code> property. The command name is the name of the file itself, and it needs to follow the following pattern:
    </p>
    <div class="sample-test" style="width: 500px">
<pre data-language="javascript">
exports.command = function(file, callback) {
  var self = this, imagedata, fs = require('fs');
  try {
    var original_data = fs.readFileSync(file);
    var base64Image = new Buffer(original_data, 'binary')
      .toString('base64');
    imagedata = 'data:image/jpeg;base64,' + base64Image;
  } catch (err) {
    console.log(err);
    throw "Unable to open file: " + file;
  }

  this.execute(
    function(imagedata) { // execute application specific code
      App.resizePicture(data);
      return true;
    },
    [imagedata], // arguments array to be passed to the function
    function(result) {
      if (typeof callback === "function") {
        callback.call(self, result);
      }
    }
  );

  return this; // allows the command to be chained.
};</pre>
</div>

    <p>The example below defines a command (e.g. resizePicture.js) which loads an image file as <code>data-URI</code> and calls a method named <code>resizePicture</code> defined inside the application.</p>

    <p>With this command, the test will look something like:</p>
<div class="sample-test">
<pre data-language="javascript">
module.exports = {
  "testing resize picture" : function (browser) {
    browser
      .url("http://app.host")
      .waitForElementVisible("body")
      .resizePicture("/var/www/pics/moon.jpg")
      .assert.element(".container .picture-large")
      .end();
  }
};</pre>
</div>
      </div>
    </div>
  </div>


  </div>
</div>

</div>
